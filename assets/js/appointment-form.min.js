function wca_get_querystring(t){"use strict";t=t.replace("/[*+?^$.\\[\\]{}()|\\/]/g","\\$&");var a=location.search.match(new RegExp("[?&]"+t+"=([^&]+)(&|$)"));return a&&decodeURIComponent(a[1].replace(/\+/g," "))}function wca_is_valid_date(t){"use strict";var a=t.split("-"),n=parseInt(a[0],10),e=parseInt(a[1],10),o=parseInt(a[2],10),i=new Date(n,e-1,o);return n===i.getFullYear()&&e===i.getMonth()+1&&o===i.getDate()}function wca_get_cookie(t){"use strict";for(var a=t+"=",n=document.cookie.split(";"),e=0;n.length>e;e++){for(var o=n[e];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(a))return o.substring(a.length,o.length)}return null}function wca_set_cookie(t,a,n){"use strict";var e="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),e="; expires="+o.toUTCString()}document.cookie=t+"="+(a||"")+e+"; path=/"}jQuery(document).ready(function(l){"use strict";var r=[],e=1,f={init:function(){l(".wc-appointments-appointment-form").show().removeAttr("disabled"),l(".wc-appointments-appointment-form-button").show().removeClass("disabled").prop("disabled",!0),e=l(".wc-appointments-appointment-form").length,l(".wc-appointments-appointment-form").each(function(){var t=l(this).closest("form");f.appointment_form_init(t)})},appointment_form_init:function(t){var a=t.find(".picker:eq(0)").attr("data-duration_unit");t.find(".wc-appointments-appointment-form-button").prop("disabled",!0),"day"===a?t.on("date-selected",this.calculate_costs).on("staff-selected",this.calculate_costs).on("addon-duration-changed",this.calculate_costs).on("addon-costs-changed",this.calculate_costs):"month"===a?t.on("month-selected",this.calculate_costs).on("staff-selected",this.calculate_costs).on("addon-duration-changed",this.calculate_costs).on("addon-costs-changed",this.calculate_costs):t.on("time-selected",this.calculate_costs).on("addon-costs-only-changed",this.calculate_costs),t.find(".quantity").on("change","input, select",this.calculate_costs),e<=1&&t.on("month-selected",this.update_querystring).on("date-selected",this.update_querystring).on("time-selected",this.update_querystring).on("staff-selected",this.update_querystring).on("addon-selected",this.update_querystring),t.on("updated_addons",this.selected_addon);var n=t.find("#product-addons-total");(n&&n.data("price_data")?n.data("price_data"):0).length&&f.selected_addon("preset",t),t.on("appointment-cost-success",this.tm_epo_integration)},selected_addon:function(t,a){"preset"!==t&&(a=l(this).closest("form"));var n=a.find(".single_add_to_cart_button").is(":disabled");a.find(".single_add_to_cart_button").prop("disabled",!0);var e=a.find("#product-addons-total"),o=e&&e.data("price_data")?e.data("price_data"):0,i=a.find("#wc_appointments_field_addons_duration"),r=a.find("#wc_appointments_field_addons_cost"),d=0<parseInt(a.find(".input-text.qty").val())?parseInt(a.find(".input-text.qty").val()):1,s=0,c=0,p=!1,_=!1;o.length&&l.each(o,function(t,a){var n=0;if(a.duration_raw_pu&&0!==parseInt(a.duration_raw_pu)?n=a.duration_raw_pu:a.duration_raw&&0!==parseInt(a.duration_raw)&&(n=a.duration_raw),0!==parseInt(n))switch(a.duration_type){case"flat_time":s+=n;break;case"quantity_based":s+=n*d;break;default:s+=n}var e=0,o=a.cost_raw,i=a.cost_raw_pu;if(i&&0!==parseFloat(i.toString().replace(/,/g,"."))?e=i:o&&0!==parseFloat(o.toString().replace(/,/g,"."))&&(e=o),0!==parseFloat(e.toString().replace(/,/g,".")))switch(a.price_type){case"flat_fee":case"percentage_based":c+=parseFloat(e/d);break;case"quantity_based":default:c+=e}}),0<i.length&&(0!==s?i.val(s):i.val(0)),0<r.length&&(0!==c?r.val(c):r.val(0)),0!==s&&wc_appointment_form_params.duration_changed!==s?(wc_appointment_form_params.duration_changed=s,a.triggerHandler("addon-duration-changed",[s]),p=!0):0!==s&&wc_appointment_form_params.duration_changed===s?(wc_appointment_form_params.duration_changed=s,a.triggerHandler("addon-duration-unchanged",[s])):(0!==s||wc_appointment_form_params.duration_changed)&&0===s&&wc_appointment_form_params.duration_changed!==s?(wc_appointment_form_params.duration_changed=!1,a.triggerHandler("addon-duration-changed",[s]),p=!0):(wc_appointment_form_params.duration_changed=!1,a.triggerHandler("addon-duration-unchanged",[s])),0!==c&&wc_appointment_form_params.costs_changed!==c?(wc_appointment_form_params.costs_changed=c,a.triggerHandler("addon-costs-changed",[c]),_=!0):0!==c&&wc_appointment_form_params.costs_changed===c?(wc_appointment_form_params.costs_changed=c,a.triggerHandler("addon-costs-unchanged",[c])):(0!==c||wc_appointment_form_params.costs_changed)&&0===c&&wc_appointment_form_params.costs_changed!==c?(wc_appointment_form_params.costs_changed=!1,a.triggerHandler("addon-costs-changed",[c]),_=!0):(wc_appointment_form_params.costs_changed=!1,a.triggerHandler("addon-costs-unchanged",[c])),_&&!p?a.triggerHandler("addon-costs-only-changed",[c]):!_&&p?a.triggerHandler("addon-duration-only-changed",[s]):_&&p&&a.triggerHandler("addon-duration-and-costs-changed",[s]),_||p||n||a.find(".single_add_to_cart_button").prop("disabled",!1),a.triggerHandler("addon-selected")},calculate_costs:function(){var t=l(this).attr("name"),n=l(this).closest("form"),a=n.find("input.required_for_calculation"),e=!0,o=n.find("fieldset").find(".picker:eq(0)"),i=n.index();if(!o.data("is_range_picker_enabled")||"wc_appointments_field_duration"===t){if(l.each(a,function(t,a){l(a).val()||(e=!1)}),!e)return n.find(".wc-appointments-appointment-cost").hide(),void n.find(".wc-appointments-appointment-hook-after").hide();n.find(".wc-appointments-appointment-cost").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),n.find(".single_add_to_cart_button").prop("disabled",!0),r[i]=l.ajax({type:"POST",url:wc_appointment_form_params.ajax_url,data:{action:"wc_appointments_calculate_costs",form:n.serialize()},success:function(t){"{"!==t.charAt(0)&&(t="{"+t.split(/\{(.+)?/)[1]);var a=JSON.parse(t);"ERROR"===a.result?(n.find(".wc-appointments-appointment-cost").html(a.html),n.find(".wc-appointments-appointment-cost").unblock(),n.find(".single_add_to_cart_button").prop("disabled",!0)):"SUCCESS"===a.result?(n.find(".wc-appointments-appointment-cost").html(a.html),n.find(".wc-appointments-appointment-cost").unblock(),n.find(".wc-appointments-appointment-hook-after").show(),n.find(".single_add_to_cart_button").prop("disabled",!1),n.triggerHandler("appointment-cost-success",[n,a.html])):(n.find(".wc-appointments-appointment-cost").hide(),n.find(".wc-appointments-appointment-hook-after").hide(),n.find(".single_add_to_cart_button").prop("disabled",!0))},error:function(){n.find(".wc-appointments-appointment-cost").hide(),n.find(".single_add_to_cart_button").prop("disabled",!0)},dataType:"html"})}},update_querystring:function(){var t=l(this).closest("form");wc_appointment_form_params.is_admin||f.set_querystring_data(t)},set_querystring_data:function(t){if(window.history&&window.history.pushState){var a=t.find("input.appointment_date_year").val(),n=t.find("input.appointment_date_month").val(),e=t.find("input.appointment_date_day").val(),o=t.find("#wc_appointments_field_start_date"),i=t.find("input#wc_appointments_field_start_date").val(),r=t.find("#wc_appointments_field_staff"),d=!i||a||n||e?a+"-"+n+"-"+e:i,s=void 0!==o.attr("data-value")?o.attr("data-value"):"",c=a&&n&&e?d:null,p=0<o.length&&""!==o.val()?s:null,_=0<r.length&&""!==r.val()?r.val():null,l=window.location.href,u=f.replace_url_parameter("date",c,l),m=c&&m?m:c&&!m?u:l;p&&(m=f.replace_url_parameter("time",p,m)),m=_?f.replace_url_parameter("staff",_,m):f.remove_url_parameter("staff",m),window.history.replaceState({date:c,time:p,staff:_},null,m)}},replace_url_parameter:function(t,a,n){var e=n.match(/[a-z\d]+=[a-z\d]+/gi),o=e?e.length:0,i=n.match(new RegExp("[?&]"+t+"=([^&]+)")),r=i?i.length:0;if(null===wca_get_querystring(t))n+=(0<o&&r<2?"&":"?")+t+"="+encodeURIComponent(a);else{var d=new RegExp("("+t+"=)[^&]+");n=n.replace(d,"$1"+encodeURIComponent(a))}return n},remove_url_parameter:function(t,a){var n=a.split("?")[0],e=[],o=-1!==a.indexOf("?")?a.split("?")[1]:"";if(""!==o){for(var i=(e=o.split("&")).length-1;0<=i;i-=1)e[i].split("=")[0]===t&&e.splice(i,1);n=n+"?"+e.join("&")}return n},tm_epo_integration:function(t,a,n){if(window.hasOwnProperty("tm_epo_js")||window.hasOwnProperty("TMEPOJS")){var e=a.find(".tc-totals-form"),o=a.find(".tc-epo-totals");if(e&&o){var i=parseFloat(l.epoAPI.util.unformat(l("<div>"+n+"</div>").find(".amount").text()));o.data("price",i),e.find(".cpf-product-price").val(i),a.trigger({type:"tm-epo-update"})}}}};f.init()});